{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Critical: hide words before animation (inline to prevent flash) */
  .manifesto-{{ section.id }} .manifesto__word {
    color: rgba(var(--color-foreground), 0);
    transform: translateY(100%);
  }
  .manifesto-{{ section.id }} .manifesto__line.is-visible .manifesto__word {
    color: rgba(var(--color-foreground), 1);
    transform: translateY(0);
  }
  .manifesto-{{ section.id }} .manifesto__divider {
    opacity: 0;
    transform: scaleX(0);
  }
  .manifesto-{{ section.id }} .manifesto__divider.is-visible {
    opacity: 1;
    transform: scaleX(1);
  }
  .manifesto-{{ section.id }} .manifesto__tagline {
    opacity: 0;
    transform: translateY(10px);
  }
  .manifesto-{{ section.id }} .manifesto__tagline.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
{%- endstyle -%}

<div class="manifesto manifesto-{{ section.id }} color-{{ section.settings.color_scheme }} section-{{ section.id }}-padding">
  <div class="manifesto__inner page-width">
    {%- for block in section.blocks -%}
      {%- case block.type -%}
        {%- when 'line' -%}
          <div
            class="manifesto__line"
            {{ block.shopify_attributes }}
          >
            {%- assign words = block.settings.text | split: ' ' -%}
            {%- for word in words -%}
              <span
                class="manifesto__word"
                style="--word-index: {{ forloop.index0 }};"
              >{{ word }}</span>
            {%- endfor -%}
          </div>

        {%- when 'divider' -%}
          <div class="manifesto__divider" {{ block.shopify_attributes }}></div>

        {%- when 'tagline' -%}
          <p
            class="manifesto__tagline"
            {{ block.shopify_attributes }}
          >
            {{ block.settings.text }}
          </p>
      {%- endcase -%}
    {%- endfor -%}
  </div>
</div>

{% stylesheet %}
  .manifesto {
    width: 100%;
    background-color: transparent !important;
    overflow: hidden;
  }

  .manifesto__inner {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
  }

  .manifesto__line {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0 1.2rem;
    overflow: hidden;
  }

  .manifesto__word {
    display: inline-block;
    font-size: clamp(3.2rem, 8vw, 9rem);
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    line-height: 1.1;
    color: rgba(var(--color-foreground), 0);
    transform: translateY(100%);
    transition: color 0.8s ease, transform 0.8s cubic-bezier(0.25, 0.1, 0.25, 1);
    transition-delay: calc(var(--word-index) * 0.08s);
  }

  .manifesto__line.is-visible .manifesto__word {
    color: rgba(var(--color-foreground), 1);
    transform: translateY(0);
  }

  .manifesto__divider {
    width: 4rem;
    height: 1px;
    background-color: rgba(var(--color-foreground), 0.2);
    margin: 1.6rem 0;
    opacity: 0;
    transform: scaleX(0);
    transition: opacity 0.6s ease 0.4s, transform 0.6s ease 0.4s;
  }

  .manifesto__divider.is-visible {
    opacity: 1;
    transform: scaleX(1);
  }

  .manifesto__tagline {
    font-size: 1.2rem;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.25em;
    color: rgba(var(--color-foreground), 0.35);
    margin: 0;
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.8s ease 0.6s, transform 0.8s ease 0.6s;
  }

  .manifesto__tagline.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
{% endstylesheet %}

<script>
  (function() {
    var section = document.querySelector('.manifesto-{{ section.id }}');
    if (!section) return;

    var targets = section.querySelectorAll('.manifesto__line, .manifesto__divider, .manifesto__tagline');
    if (!targets.length) return;

    var observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.15,
      rootMargin: '0px 0px -40px 0px'
    });

    targets.forEach(function(target) {
      observer.observe(target);
    });
  })();
</script>

{% schema %}
{
  "name": "t:sections.manifesto.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 100
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 100
    }
  ],
  "blocks": [
    {
      "type": "line",
      "name": "t:sections.manifesto.blocks.line.name",
      "limit": 4,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "t:sections.manifesto.blocks.line.settings.text.label",
          "default": "t:sections.manifesto.blocks.line.settings.text.default"
        }
      ]
    },
    {
      "type": "divider",
      "name": "t:sections.manifesto.blocks.divider.name",
      "limit": 1
    },
    {
      "type": "tagline",
      "name": "t:sections.manifesto.blocks.tagline.name",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "t:sections.manifesto.blocks.tagline.settings.text.label",
          "default": "t:sections.manifesto.blocks.tagline.settings.text.default"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.manifesto.presets.name",
      "blocks": [
        { "type": "line", "settings": { "text": "Born from darkness." } },
        { "type": "line", "settings": { "text": "Worn with bite." } },
        { "type": "divider" },
        { "type": "tagline", "settings": { "text": "Est. 2025" } }
      ]
    }
  ]
}
{% endschema %}
